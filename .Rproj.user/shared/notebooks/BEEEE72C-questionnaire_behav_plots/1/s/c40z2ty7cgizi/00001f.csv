"0","################## MODERATION FOR SIGNIFICANT RESULTS ONLY ###################"
"0",""
"0","# Define subscale mapping"
"0","subscale_mapping <- list("
"0","  lsas = c(""lsas_p"", ""lsas_s""),"
"0","  dass = c(""dass_a"", ""dass_d"", ""dass_s""),"
"0","  ssms = c(""ssms_cd"", ""ssms_ia""),"
"0","  srp_sf = c(""srp_sf_ipm"", ""srp_sf_ca"", ""srp_sf_els"", ""srp_sf_ct""),"
"0","  ami = c(""ami_es"", ""ami_sm"", ""ami_ba""),"
"0","  aq_10 = NULL"
"0",")"
"0",""
"0","# First extract and scale the subscale data at participant level"
"0","subscale_data <- merged_data %>%"
"0","  group_by(participant.id_in_session) %>%"
"0","  slice(1) %>%"
"0","  select(participant.id_in_session,"
"0","         lsas_p, lsas_s,"
"0","         dass_a, dass_d, dass_s,"
"0","         ssms_cd, ssms_ia,"
"0","         srp_sf_ipm, srp_sf_ca, srp_sf_els, srp_sf_ct,"
"0","         ami_es, ami_sm, ami_ba) "
"0",""
"0","# Now scale the columns separately"
"0","subscale_data_scaled <- subscale_data %>%"
"0","  ungroup() %>%"
"0","  mutate(across(-participant.id_in_session, ~as.vector(scale(.x))))"
"0",""
"0","# Define function for moderation analysis"
"0","run_moderation_analysis <- function(data, scale_name, subscales = NULL) {"
"0","  # First run moderation for main scale"
"0","  main_model <- lmer(switch_prob ~ consensus_group * scale_name + "
"0","                    age + (1|participant.id_in_session),"
"0","                    data = data,"
"0","                    control = lmerControl(optimizer = ""bobyqa""))"
"0","  "
"0","  results <- list(main = list("
"0","    scale = scale_name,"
"0","    model = main_model,"
"0","    summary = summary(main_model)"
"0","  ))"
"0","  "
"0","  # Then run for subscales if they exist"
"0","  if (!is.null(subscales)) {"
"0","    subscale_results <- map(subscales, function(subscale) {"
"0","      if(subscale %in% names(data)) {  # Only run if subscale exists in data"
"0","        sub_model <- lmer(as.formula(paste("
"0","          ""switch_prob ~ consensus_group *"", subscale,"
"0","          ""+ age + (1|participant.id_in_session)"""
"0","        )),"
"0","        data = data,"
"0","        control = lmerControl(optimizer = ""bobyqa""))"
"0","        "
"0","        list("
"0","          scale = subscale,"
"0","          model = sub_model,"
"0","          summary = summary(sub_model)"
"0","        )"
"0","      } else {"
"0","        NULL"
"0","      }"
"0","    })"
"0","    results$subscales <- compact(subscale_results)  # Remove NULL results"
"0","  }"
"0","  "
"0","  return(results)"
"0","}"
"0",""
"0","# Join scaled subscales to switch_probabilities"
"0","switch_probabilities_with_subscales <- switch_probabilities %>%"
"0","  left_join(subscale_data_scaled, by = ""participant.id_in_session"")"
"0",""
"0","# Then run the moderation analysis"
"0","if(length(significant_analyses) > 0) {"
"0","  moderation_results <- map(significant_analyses, function(scale) {"
"0","    subscales <- subscale_mapping[[scale]]"
"0","    "
"0","    # Prepare data with scale and subscales"
"0","    mod_data <- switch_probabilities_with_subscales %>%"
"0","      rename(scale_name = !!scale)"
"0","    "
"0","    run_moderation_analysis(mod_data, ""scale_name"", subscales)"
"0","  })"
"0","  "
"0","  # Print results and create visualization"
"0","  for(i in seq_along(moderation_results)) {"
"0","    scale_name <- significant_analyses[i]"
"0","    results <- moderation_results[[i]]"
"0","    "
"0","    cat(""\nModeration Analysis Results for"", scale_name, ""\n"")"
"0","    cat(""Main Scale Results:\n"")"
"0","    print(anova(results$main$model))"
"0","    "
"0","    if(!is.null(results$subscales)) {"
"0","      cat(""\nSubscale Results:\n"")"
"0","      for(sub_result in results$subscales) {"
"0","        cat(""\nSubscale:"", sub_result$scale, ""\n"")"
"0","        print(anova(sub_result$model))"
"0","      }"
"0","    }"
"0","    "
"0","    # Create visualization for significant moderations"
"0","    plot_moderation <- function(model, title) {"
"0","      # Create a data frame for predictions"
"0","      new_data <- expand.grid("
"0","        consensus_group = unique(model@frame$consensus_group),"
"0","        scale_name = c(-1, 0, 1),"
"0","        age = 0  # mean of scaled age"
"0","      )"
"0","      "
"0","      # Get predictions"
"0","      new_data$predicted <- predict(model, newdata = new_data, re.form = NA)"
"0","      "
"0","      # Create plot"
"0","      ggplot(new_data, "
"0","             aes(x = consensus_group, "
"0","                 y = predicted, "
"0","                 color = as.factor(scale_name),"
"0","                 group = scale_name)) +"
"0","        geom_line() +"
"0","        geom_point() +"
"0","        scale_color_manual(values = c(""red"", ""purple"", ""blue""),"
"0","                          name = ""DASS Score"","
"0","                          labels = c(""-1 SD"", ""Mean"", ""+1 SD"")) +"
"0","        theme_custom +"
"0","        labs(title = title,"
"0","             x = ""Consensus Group"","
"0","             y = ""Predicted Switch Probability (%)"")"
"0","    }"
"0","    "
"0","    print(plot_moderation(results$main$model, "
"0","                         paste(""Moderation Effect of"", scale_name)))"
"0","  }"
"0","} else {"
"0","  print(""No significant results to analyze with moderation"")"
"0","}"
"2","boundary (singular) fit: see help('isSingular')
"
"2","boundary (singular) fit: see help('isSingular')
"
"2","boundary (singular) fit: see help('isSingular')
"
"2","boundary (singular) fit: see help('isSingular')
"
"2","boundary (singular) fit: see help('isSingular')
"
"2","boundary (singular) fit: see help('isSingular')
"
"2","boundary (singular) fit: see help('isSingular')
"
"2","boundary (singular) fit: see help('isSingular')
"
"2","boundary (singular) fit: see help('isSingular')
"
"1","
Moderation Analysis Results for"
"1"," "
"1","dass"
"1"," "
"1","
"
"1","Main Scale Results:
"
"1","Type III Analysis of Variance Table with Satterthwaite's method"
"1","
"
"1","                          "
"1","  Sum Sq"
"1"," Mean Sq"
"1"," NumDF"
"1"," DenDF"
"1"," F value"
"1","  Pr(>F)"
"1","  "
"1","
consensus_group           "
"1"," 2847.76"
"1","  711.94"
"1","     4"
"1","    38"
"1","  2.7520"
"1"," 0.04192"
"1"," *"
"1","
scale_name                "
"1","    0.59"
"1","    0.59"
"1","     1"
"1","    38"
"1","  0.0023"
"1"," 0.96217"
"1","  "
"1","
age                       "
"1","  175.78"
"1","  175.78"
"1","     1"
"1","    38"
"1","  0.6795"
"1"," 0.41491"
"1","  "
"1","
consensus_group:scale_name"
"1"," 2229.41"
"1","  557.35"
"1","     4"
"1","    38"
"1","  2.1545"
"1"," 0.09285"
"1"," ."
"1","
"
"1","---
Signif. codes:  "
"1",""
"1","0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1"
"1","
"
"1","
Subscale Results:
"
"1","
Subscale:"
"1"," "
"1","dass_a"
"1"," "
"1","
"
"1","Type III Analysis of Variance Table with Satterthwaite's method"
"1","
"
"1","                      "
"1","  Sum Sq"
"1"," Mean Sq"
"1"," NumDF"
"1"," DenDF"
"1"," F value"
"1","  Pr(>F)"
"1","  "
"1","
consensus_group       "
"1"," 3052.50"
"1","  763.13"
"1","     4"
"1","    38"
"1","  2.5481"
"1"," 0.05493"
"1"," ."
"1","
dass_a                "
"1","  261.83"
"1","  261.83"
"1","     1"
"1","    38"
"1","  0.8743"
"1"," 0.35568"
"1","  "
"1","
age                   "
"1","  143.78"
"1","  143.78"
"1","     1"
"1","    38"
"1","  0.4801"
"1"," 0.49260"
"1","  "
"1","
consensus_group:dass_a"
"1","  433.57"
"1","  108.39"
"1","     4"
"1","    38"
"1","  0.3619"
"1"," 0.83412"
"1","  "
"1","
"
"1","---
Signif. codes:  "
"1",""
"1","0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1"
"1","
"
"1","
Subscale:"
"1"," "
"1","dass_d"
"1"," "
"1","
"
"1","Type III Analysis of Variance Table with Satterthwaite's method"
"1","
"
"1","                      "
"1","  Sum Sq"
"1"," Mean Sq"
"1"," NumDF"
"1"," DenDF"
"1"," F value"
"1","  Pr(>F)"
"1","  "
"1","
consensus_group       "
"1"," 3056.27"
"1","  764.07"
"1","     4"
"1","    38"
"1","  2.6014"
"1"," 0.05118"
"1"," ."
"1","
dass_d                "
"1","   14.73"
"1","   14.73"
"1","     1"
"1","    38"
"1","  0.0502"
"1"," 0.82397"
"1","  "
"1","
age                   "
"1","  130.35"
"1","  130.35"
"1","     1"
"1","    38"
"1","  0.4438"
"1"," 0.50932"
"1","  "
"1","
consensus_group:dass_d"
"1","  912.29"
"1","  228.07"
"1","     4"
"1","    38"
"1","  0.7765"
"1"," 0.54739"
"1","  "
"1","
"
"1","---
Signif. codes:  "
"1",""
"1","0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1"
"1","
"
"1","
Subscale:"
"1"," "
"1","dass_s"
"1"," "
"1","
"
"1","Type III Analysis of Variance Table with Satterthwaite's method"
"1","
"
"1","                      "
"1","  Sum Sq"
"1"," Mean Sq"
"1"," NumDF"
"1"," DenDF"
"1"," F value"
"1","  Pr(>F)"
"1","  "
"1","
consensus_group       "
"1"," 2980.01"
"1","  745.00"
"1","     4"
"1","    38"
"1","  2.8170"
"1"," 0.03847"
"1"," *"
"1","
dass_s                "
"1","  127.73"
"1","  127.73"
"1","     1"
"1","    38"
"1","  0.4830"
"1"," 0.49131"
"1","  "
"1","
age                   "
"1","   33.64"
"1","   33.64"
"1","     1"
"1","    38"
"1","  0.1272"
"1"," 0.72331"
"1","  "
"1","
consensus_group:dass_s"
"1"," 1899.65"
"1","  474.91"
"1","     4"
"1","    38"
"1","  1.7957"
"1"," 0.14985"
"1","  "
"1","
"
"1","---
Signif. codes:  "
"1",""
"1","0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1"
"1","
"
"1","
Moderation Analysis Results for"
"1"," "
"1","ami"
"1"," "
"1","
"
"1","Main Scale Results:
"
"1","Type III Analysis of Variance Table with Satterthwaite's method"
"1","
"
"1","                          "
"1","  Sum Sq"
"1"," Mean Sq"
"1"," NumDF"
"1"," DenDF"
"1"," F value"
"1","  Pr(>F)"
"1","  "
"1","
consensus_group           "
"1"," 3076.40"
"1","  769.10"
"1","     4"
"1","    38"
"1","  3.0394"
"1"," 0.02871"
"1"," *"
"1","
scale_name                "
"1","   22.17"
"1","   22.17"
"1","     1"
"1","    38"
"1","  0.0876"
"1"," 0.76882"
"1","  "
"1","
age                       "
"1","   99.17"
"1","   99.17"
"1","     1"
"1","    38"
"1","  0.3919"
"1"," 0.53504"
"1","  "
"1","
consensus_group:scale_name"
"1"," 2450.33"
"1","  612.58"
"1","     4"
"1","    38"
"1","  2.4209"
"1"," 0.06507"
"1"," ."
"1","
"
"1","---
Signif. codes:  "
"1",""
"1","0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1"
"1","
"
"1","
Subscale Results:
"
"1","
Subscale:"
"1"," "
"1","ami_es"
"1"," "
"1","
"
"1","Type III Analysis of Variance Table with Satterthwaite's method"
"1","
"
"1","                      "
"1","  Sum Sq"
"1"," Mean Sq"
"1"," NumDF"
"1"," DenDF"
"1"," F value"
"1","  Pr(>F)"
"1","  "
"1","
consensus_group       "
"1"," 3091.18"
"1","  772.79"
"1","     4"
"1","    38"
"1","  2.9077"
"1"," 0.03414"
"1"," *"
"1","
ami_es                "
"1","   57.46"
"1","   57.46"
"1","     1"
"1","    38"
"1","  0.2162"
"1"," 0.64460"
"1","  "
"1","
age                   "
"1","  138.22"
"1","  138.22"
"1","     1"
"1","    38"
"1","  0.5201"
"1"," 0.47523"
"1","  "
"1","
consensus_group:ami_es"
"1"," 1932.65"
"1","  483.16"
"1","     4"
"1","    38"
"1","  1.8179"
"1"," 0.14549"
"1","  "
"1","
"
"1","---
Signif. codes:  "
"1",""
"1","0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1"
"1","
"
"1","
Subscale:"
"1"," "
"1","ami_sm"
"1"," "
"1","
"
"1","Type III Analysis of Variance Table with Satterthwaite's method"
"1","
"
"1","                      "
"1","  Sum Sq"
"1"," Mean Sq"
"1"," NumDF"
"1"," DenDF"
"1"," F value"
"1","  Pr(>F)"
"1","  "
"1","
consensus_group       "
"1"," 3051.56"
"1","  762.89"
"1","     4"
"1","    38"
"1","  2.9118"
"1"," 0.03395"
"1"," *"
"1","
ami_sm                "
"1","   94.95"
"1","   94.95"
"1","     1"
"1","    38"
"1","  0.3624"
"1"," 0.55076"
"1","  "
"1","
age                   "
"1","  248.50"
"1","  248.50"
"1","     1"
"1","    38"
"1","  0.9485"
"1"," 0.33627"
"1","  "
"1","
consensus_group:ami_sm"
"1"," 2036.60"
"1","  509.15"
"1","     4"
"1","    38"
"1","  1.9433"
"1"," 0.12310"
"1","  "
"1","
"
"1","---
Signif. codes:  "
"1",""
"1","0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1"
"1","
"
"1","
Subscale:"
"1"," "
"1","ami_ba"
"1"," "
"1","
"
"1","Type III Analysis of Variance Table with Satterthwaite's method"
"1","
"
"1","                      "
"1","  Sum Sq"
"1"," Mean Sq"
"1"," NumDF"
"1"," DenDF"
"1"," F value"
"1","  Pr(>F)"
"1","  "
"1","
consensus_group       "
"1"," 3041.81"
"1","  760.45"
"1","     4"
"1","    38"
"1","  3.1504"
"1"," 0.02483"
"1"," *"
"1","
ami_ba                "
"1","   12.71"
"1","   12.71"
"1","     1"
"1","    38"
"1","  0.0526"
"1"," 0.81977"
"1","  "
"1","
age                   "
"1","  113.96"
"1","  113.96"
"1","     1"
"1","    38"
"1","  0.4721"
"1"," 0.49619"
"1","  "
"1","
consensus_group:ami_ba"
"1"," 2902.79"
"1","  725.70"
"1","     4"
"1","    38"
"1","  3.0064"
"1"," 0.02998"
"1"," *"
"1","
"
"1","---
Signif. codes:  "
"1",""
"1","0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1"
"1","
"
"1","
Moderation Analysis Results for"
"1"," "
"1","aq_10"
"1"," "
"1","
"
"1","Main Scale Results:
"
"1","Type III Analysis of Variance Table with Satterthwaite's method"
"1","
"
"1","                          "
"1"," Sum Sq"
"1"," Mean Sq"
"1"," NumDF"
"1"," DenDF"
"1"," F value"
"1","  Pr(>F)"
"1","  "
"1","
consensus_group           "
"1"," 3348.5"
"1","  837.11"
"1","     4"
"1","    38"
"1","  3.3457"
"1"," 0.01926"
"1"," *"
"1","
scale_name                "
"1","  327.4"
"1","  327.43"
"1","     1"
"1","    38"
"1","  1.3086"
"1"," 0.25980"
"1","  "
"1","
age                       "
"1","    2.6"
"1","    2.64"
"1","     1"
"1","    38"
"1","  0.0106"
"1"," 0.91869"
"1","  "
"1","
consensus_group:scale_name"
"1"," 2314.2"
"1","  578.54"
"1","     4"
"1","    38"
"1","  2.3123"
"1"," 0.07521"
"1"," ."
"1","
"
"1","---
Signif. codes:  "
"1",""
"1","0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1"
"1","
"
