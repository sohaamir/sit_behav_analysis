"0",""
"0","if(length(c(significant_choice, significant_bet)) == 0) {"
"0","  print(""No significant relationships found after multiple comparison correction"")"
"0","}"
"0",""
"0","############ FURTHER ANALYSES FOR SUBSCALES OF SIGNFICIANT FINDINGS ABOVE ########"
"0",""
"0","# Define subscale mapping"
"0","subscale_mapping <- list("
"0","  lsas = c(""lsas_p"", ""lsas_s""),"
"0","  dass = c(""dass_a"", ""dass_d"", ""dass_s""),"
"0","  ssms = c(""ssms_cd"", ""ssms_ia""),"
"0","  srp_sf = c(""srp_sf_ipm"", ""srp_sf_ca"", ""srp_sf_els"", ""srp_sf_ct""),"
"0","  ami = c(""ami_es"", ""ami_sm"", ""ami_ba""),"
"0","  aq_10 = NULL"
"0",")"
"0",""
"0","# If there are significant relationships, analyze their subscales"
"0","if(length(c(significant_choice, significant_bet)) > 0) {"
"0","  cat(""\n=== Starting Subscale Analysis ===\n"")"
"0","  "
"0","  # Get unique significant questionnaires"
"0","  significant_questionnaires <- unique(c(significant_choice, significant_bet))"
"0","  cat(""\nSignificant questionnaires identified:"", paste(significant_questionnaires, collapse="", ""), ""\n"")"
"0","  "
"0","  # Create subscale participant data with preserved column names"
"0","  subscale_participant_data <- data %>%"
"0","    group_by(participant.id_in_session) %>%"
"0","    summarise("
"0","      choice_accuracy_diff = mean(player.choice2_accuracy - player.choice1_accuracy) * 100,"
"0","      bet_magnitude_diff = mean(player.bet2 - player.bet1),"
"0","      across(c(lsas_p, lsas_s,"
"0","               dass_a, dass_d, dass_s,"
"0","               ssms_cd, ssms_ia,"
"0","               srp_sf_ipm, srp_sf_ca, srp_sf_els, srp_sf_ct,"
"0","               ami_es, ami_sm, ami_ba), "
"0","             ~first(.x), "
"0","             .names = ""{.col}"")"
"0","    )"
"0","    "
"0","  # Modified function for subscale analysis"
"0","  analyze_subscale_effects <- function(subscale) {"
"0","    cat(""\n    Analyzing effects for subscale:"", subscale)"
"0","    "
"0","    # For choice accuracy"
"0","    choice_model <- lm(paste(""choice_accuracy_diff ~"", subscale), "
"0","                      data = subscale_participant_data)"
"0","    "
"0","    # For bet magnitude"
"0","    bet_model <- lm(paste(""bet_magnitude_diff ~"", subscale), "
"0","                   data = subscale_participant_data)"
"0","    "
"0","    # Extract results"
"0","    choice_p <- summary(choice_model)$coefficients[2,4]"
"0","    bet_p <- summary(bet_model)$coefficients[2,4]"
"0","    "
"0","    # Calculate correlations"
"0","    choice_cor <- cor.test(subscale_participant_data[[subscale]], "
"0","                          subscale_participant_data$choice_accuracy_diff)"
"0","    bet_cor <- cor.test(subscale_participant_data[[subscale]], "
"0","                        subscale_participant_data$bet_magnitude_diff)"
"0","    "
"0","    result <- tibble("
"0","      questionnaire = subscale,"
"0","      choice_p = choice_p,"
"0","      bet_p = bet_p,"
"0","      choice_r = choice_cor$estimate,"
"0","      bet_r = bet_cor$estimate"
"0","    )"
"0","    "
"0","    cat(""\n    Results computed for"", subscale, ""\n"")"
"0","    return(result)"
"0","  }"
"0","  "
"0","  # Modify the analysis section to:"
"0","  subscale_results <- NULL"
"0","  for(questionnaire in significant_questionnaires) {"
"0","    cat(""\n\nProcessing main questionnaire:"", questionnaire)"
"0","    subscales <- subscale_mapping[[questionnaire]]"
"0","    cat(""\nFound subscales:"", paste(subscales, collapse="", ""))"
"0","    "
"0","    if(!is.null(subscales)) {"
"0","      # Create results for each subscale"
"0","      questionnaire_results <- map_df(subscales, function(subscale) {"
"0","        cat(""\n  Processing subscale:"", subscale, ""for parent:"", questionnaire)"
"0","        result <- analyze_subscale_effects(subscale) "
"0","        result$parent_scale <- questionnaire  # Add parent scale directly to result"
"0","        cat(""\n  Added parent_scale:"", questionnaire, ""for subscale:"", subscale)"
"0","        return(result)"
"0","      })"
"0","      "
"0","      # Append to main results"
"0","      subscale_results <- bind_rows(subscale_results, questionnaire_results)"
"0","    }"
"0","  }"
"0","  "
"0","  # Print debug information about results"
"0","  cat(""\n=== Subscale Results Structure ===\n"")"
"0","  str(subscale_results)"
"0","  cat(""\n=== First few rows of results ===\n"")"
"0","  print(head(subscale_results))"
"0","  "
"0","  # Add FDR correction for subscales"
"0","  subscale_results <- subscale_results %>%"
"0","    group_by(parent_scale) %>%"
"0","    mutate("
"0","      choice_p_adj = p.adjust(choice_p, method = ""fdr""),"
"0","      bet_p_adj = p.adjust(bet_p, method = ""fdr"")"
"0","    ) %>%"
"0","    ungroup()"
"0","  "
"0","  # Print subscale results"
"0","  cat(""\n=== Final Subscale Analysis Results ===\n"")"
"0","  print(subscale_results %>%"
"0","        mutate(across(where(is.numeric), ~round(., 3))))"
"0","  "
"0","  # Plot subscale relationships"
"0","  plot_relationship_subscale <- function(questionnaire, measure = ""choice"", data = subscale_participant_data) {"
"0","    parent_scale <- subscale_results$parent_scale[subscale_results$questionnaire == questionnaire]"
"0","    cat(""\nPlotting"", questionnaire, ""from parent scale:"", parent_scale)"
"0","    "
"0","    if(measure == ""choice"") {"
"0","      y_var <- ""choice_accuracy_diff"""
"0","      y_lab <- ""Choice accuracy difference (%)"""
"0","      fill_color <- ""#1f77b4"""
"0","      r_val <- subscale_results$choice_r[subscale_results$questionnaire == questionnaire]"
"0","      p_val <- subscale_results$choice_p[subscale_results$questionnaire == questionnaire]"
"0","    } else {"
"0","      y_var <- ""bet_magnitude_diff"""
"0","      y_lab <- ""Bet magnitude difference"""
"0","      fill_color <- ""#2ca02c"""
"0","      r_val <- subscale_results$bet_r[subscale_results$questionnaire == questionnaire]"
"0","      p_val <- subscale_results$bet_p[subscale_results$questionnaire == questionnaire]"
"0","    }"
"0","    "
"0","    p <- ggplot(data, "
"0","                aes(x = .data[[questionnaire]], y = .data[[y_var]])) +"
"0","      geom_point() +"
"0","      geom_smooth(method = ""lm"", color = fill_color) +"
"0","      labs("
"0","        x = questionnaire,"
"0","        y = y_lab,"
"0","        title = paste(""Effect of"", questionnaire, ""on"", measure),"
"0","        subtitle = sprintf("
"0","          ""r = %.3f, p = %.3f"","
"0","          r_val,"
"0","          p_val"
"0","        )"
"0","      ) +"
"0","      theme_classic()"
"0","    "
"0","    print(p)"
"0","  }"
"0","  "
"0","  # Plot subscale relationships"
"0","  cat(""\n=== Starting Plot Generation ===\n"")"
"0","  for(scale in unique(subscale_results$parent_scale)) {"
"0","    cat(""\nAnalyzing parent scale:"", scale)"
"0","    "
"0","    # Plot for choice accuracy"
"0","    if(scale %in% significant_choice) {"
"0","      cat(""\nScale is in significant_choice"")"
"0","      significant_subscales <- subscale_results %>%"
"0","        filter(parent_scale == scale, choice_p_adj < 0.5) %>%"
"0","        pull(questionnaire)"
"0","      "
"0","      cat(""\nSignificant subscales for choice:"", paste(significant_subscales, collapse="", ""))"
"0","      "
"0","      for(subscale in significant_subscales) {"
"0","        cat(""\nPlotting choice subscale:"", subscale)"
"0","        plot_relationship_subscale(subscale, ""choice"")"
"0","      }"
"0","    }"
"0","    "
"0","    # Plot for bet magnitude"
"0","    if(scale %in% significant_bet) {"
"0","      cat(""\nScale is in significant_bet"")"
"0","      significant_subscales <- subscale_results %>%"
"0","        filter(parent_scale == scale, bet_p_adj < 0.5) %>%"
"0","        pull(questionnaire)"
"0","      "
"0","      cat(""\nSignificant subscales for bet:"", paste(significant_subscales, collapse="", ""))"
"0","      "
"0","      for(subscale in significant_subscales) {"
"0","        cat(""\nPlotting bet subscale:"", subscale)"
"0","        plot_relationship_subscale(subscale, ""bet"")"
"0","      }"
"0","    }"
"0","  }"
"0","} else {"
"0","  print(""No significant main scale results to analyze at subscale level"")"
"0","}"
"1","
=== Starting Subscale Analysis ===
"
"1","
Significant questionnaires identified:"
"1"," "
"1","ami, dass, lsas, srp_sf"
"1"," "
"1","
"
"1","

Processing main questionnaire:"
"1"," "
"1","ami"
"1","
Found subscales:"
"1"," "
"1","ami_es, ami_sm, ami_ba"
"1","
  Processing subscale:"
"1"," "
"1","ami_es"
"1"," "
"1","for parent:"
"1"," "
"1","ami"
"1","
    Analyzing effects for subscale:"
"1"," "
"1","ami_es"
"1","
    Results computed for"
"1"," "
"1","ami_es"
"1"," "
"1","
"
"1","
  Added parent_scale:"
"1"," "
"1","ami"
"1"," "
"1","for subscale:"
"1"," "
"1","ami_es"
"1","
  Processing subscale:"
"1"," "
"1","ami_sm"
"1"," "
"1","for parent:"
"1"," "
"1","ami"
"1","
    Analyzing effects for subscale:"
"1"," "
"1","ami_sm"
"1","
    Results computed for"
"1"," "
"1","ami_sm"
"1"," "
"1","
"
"1","
  Added parent_scale:"
"1"," "
"1","ami"
"1"," "
"1","for subscale:"
"1"," "
"1","ami_sm"
"1","
  Processing subscale:"
"1"," "
"1","ami_ba"
"1"," "
"1","for parent:"
"1"," "
"1","ami"
"1","
    Analyzing effects for subscale:"
"1"," "
"1","ami_ba"
"1","
    Results computed for"
"1"," "
"1","ami_ba"
"1"," "
"1","
"
"1","
  Added parent_scale:"
"1"," "
"1","ami"
"1"," "
"1","for subscale:"
"1"," "
"1","ami_ba"
"1","

Processing main questionnaire:"
"1"," "
"1","dass"
"1","
Found subscales:"
"1"," "
"1","dass_a, dass_d, dass_s"
"1","
  Processing subscale:"
"1"," "
"1","dass_a"
"1"," "
"1","for parent:"
"1"," "
"1","dass"
"1","
    Analyzing effects for subscale:"
"1"," "
"1","dass_a"
"1","
    Results computed for"
"1"," "
"1","dass_a"
"1"," "
"1","
"
"1","
  Added parent_scale:"
"1"," "
"1","dass"
"1"," "
"1","for subscale:"
"1"," "
"1","dass_a"
"1","
  Processing subscale:"
"1"," "
"1","dass_d"
"1"," "
"1","for parent:"
"1"," "
"1","dass"
"1","
    Analyzing effects for subscale:"
"1"," "
"1","dass_d"
"1","
    Results computed for"
"1"," "
"1","dass_d"
"1"," "
"1","
"
"1","
  Added parent_scale:"
"1"," "
"1","dass"
"1"," "
"1","for subscale:"
"1"," "
"1","dass_d"
"1","
  Processing subscale:"
"1"," "
"1","dass_s"
"1"," "
"1","for parent:"
"1"," "
"1","dass"
"1","
    Analyzing effects for subscale:"
"1"," "
"1","dass_s"
"1","
    Results computed for"
"1"," "
"1","dass_s"
"1"," "
"1","
"
"1","
  Added parent_scale:"
"1"," "
"1","dass"
"1"," "
"1","for subscale:"
"1"," "
"1","dass_s"
"1","

Processing main questionnaire:"
"1"," "
"1","lsas"
"1","
Found subscales:"
"1"," "
"1","lsas_p, lsas_s"
"1","
  Processing subscale:"
"1"," "
"1","lsas_p"
"1"," "
"1","for parent:"
"1"," "
"1","lsas"
"1","
    Analyzing effects for subscale:"
"1"," "
"1","lsas_p"
"1","
    Results computed for"
"1"," "
"1","lsas_p"
"1"," "
"1","
"
"1","
  Added parent_scale:"
"1"," "
"1","lsas"
"1"," "
"1","for subscale:"
"1"," "
"1","lsas_p"
"1","
  Processing subscale:"
"1"," "
"1","lsas_s"
"1"," "
"1","for parent:"
"1"," "
"1","lsas"
"1","
    Analyzing effects for subscale:"
"1"," "
"1","lsas_s"
"1","
    Results computed for"
"1"," "
"1","lsas_s"
"1"," "
"1","
"
"1","
  Added parent_scale:"
"1"," "
"1","lsas"
"1"," "
"1","for subscale:"
"1"," "
"1","lsas_s"
"1","

Processing main questionnaire:"
"1"," "
"1","srp_sf"
"1","
Found subscales:"
"1"," "
"1","srp_sf_ipm, srp_sf_ca, srp_sf_els, srp_sf_ct"
"1","
  Processing subscale:"
"1"," "
"1","srp_sf_ipm"
"1"," "
"1","for parent:"
"1"," "
"1","srp_sf"
"1","
    Analyzing effects for subscale:"
"1"," "
"1","srp_sf_ipm"
"1","
    Results computed for"
"1"," "
"1","srp_sf_ipm"
"1"," "
"1","
"
"1","
  Added parent_scale:"
"1"," "
"1","srp_sf"
"1"," "
"1","for subscale:"
"1"," "
"1","srp_sf_ipm"
"1","
  Processing subscale:"
"1"," "
"1","srp_sf_ca"
"1"," "
"1","for parent:"
"1"," "
"1","srp_sf"
"1","
    Analyzing effects for subscale:"
"1"," "
"1","srp_sf_ca"
"1","
    Results computed for"
"1"," "
"1","srp_sf_ca"
"1"," "
"1","
"
"1","
  Added parent_scale:"
"1"," "
"1","srp_sf"
"1"," "
"1","for subscale:"
"1"," "
"1","srp_sf_ca"
"1","
  Processing subscale:"
"1"," "
"1","srp_sf_els"
"1"," "
"1","for parent:"
"1"," "
"1","srp_sf"
"1","
    Analyzing effects for subscale:"
"1"," "
"1","srp_sf_els"
"1","
    Results computed for"
"1"," "
"1","srp_sf_els"
"1"," "
"1","
"
"1","
  Added parent_scale:"
"1"," "
"1","srp_sf"
"1"," "
"1","for subscale:"
"1"," "
"1","srp_sf_els"
"1","
  Processing subscale:"
"1"," "
"1","srp_sf_ct"
"1"," "
"1","for parent:"
"1"," "
"1","srp_sf"
"1","
    Analyzing effects for subscale:"
"1"," "
"1","srp_sf_ct"
"1","
    Results computed for"
"1"," "
"1","srp_sf_ct"
"1"," "
"1","
"
"1","
  Added parent_scale:"
"1"," "
"1","srp_sf"
"1"," "
"1","for subscale:"
"1"," "
"1","srp_sf_ct"
"1","
=== Subscale Results Structure ===
"
"1","tibble [12 × 6]"
"1",""
"1"," (S3: "
"1",""
"1","tbl_df/tbl/data.frame"
"1",""
"1",")"
"1",""
"1","
"
"1"," "
"1",""
"1","$ "
"1",""
"1","questionnaire"
"1",""
"1",":"
"1"," chr [1:12] "
"1",""
"1","""ami_es"" ""ami_sm"" ""ami_ba"" ""dass_a"""
"1",""
"1"," ..."
"1",""
"1","
"
"1"," "
"1",""
"1","$ "
"1",""
"1","choice_p     "
"1",""
"1",":"
"1"," num [1:12] "
"1",""
"1","0.739 0.312 0.401 0.284 0.608"
"1",""
"1"," ..."
"1",""
"1","
"
"1"," "
"1",""
"1","$ "
"1",""
"1","bet_p        "
"1",""
"1",":"
"1"," num [1:12] "
"1",""
"1","0.303 0.603 0.547 0.662 0.196"
"1",""
"1"," ..."
"1",""
"1","
"
"1"," "
"1",""
"1","$ "
"1",""
"1","choice_r     "
"1",""
"1",":"
"1"," Named num [1:12] "
"1",""
"1","-0.121 0.357 0.299 0.376 -0.185"
"1",""
"1"," ..."
"1",""
"1","
"
"1","  .."
"1",""
"1","- attr(*, ""names"")="
"1"," chr [1:12] "
"1",""
"1","""cor"" ""cor"" ""cor"" ""cor"""
"1",""
"1"," ..."
"1",""
"1","
"
"1"," "
"1",""
"1","$ "
"1",""
"1","bet_r        "
"1",""
"1",":"
"1"," Named num [1:12] "
"1",""
"1","0.363 -0.188 -0.217 0.159 -0.446"
"1",""
"1"," ..."
"1",""
"1","
"
"1","  .."
"1",""
"1","- attr(*, ""names"")="
"1"," chr [1:12] "
"1",""
"1","""cor"" ""cor"" ""cor"" ""cor"""
"1",""
"1"," ..."
"1",""
"1","
"
"1"," "
"1",""
"1","$ "
"1",""
"1","parent_scale "
"1",""
"1",":"
"1"," chr [1:12] "
"1",""
"1","""ami"" ""ami"" ""ami"" ""dass"""
"1",""
"1"," ..."
"1",""
"1","
"
"1","
=== First few rows of results ===
"
