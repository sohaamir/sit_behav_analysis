"0","################## MODERATION FOR SIGNIFICANT RESULTS ONLY ###################"
"0",""
"0","# Define subscale mapping"
"0","subscale_mapping <- list("
"0","  lsas = c(""lsas_p"", ""lsas_s""),"
"0","  dass = c(""dass_a"", ""dass_d"", ""dass_s""),"
"0","  ssms = c(""ssms_cd"", ""ssms_ia""),"
"0","  srp_sf = c(""srp_sf_ipm"", ""srp_sf_ca"", ""srp_sf_els"", ""srp_sf_ct""),"
"0","  ami = c(""ami_es"", ""ami_sm"", ""ami_ba""),"
"0","  aq_10 = NULL"
"0",")"
"0",""
"0","# Extract and scale the subscale data at participant level"
"0","subscale_data <- merged_data %>%"
"0","  group_by(participant.id_in_session) %>%"
"0","  slice(1) %>%"
"0","  select(participant.id_in_session,"
"0","         lsas_p, lsas_s,"
"0","         dass_a, dass_d, dass_s,"
"0","         ssms_cd, ssms_ia,"
"0","         srp_sf_ipm, srp_sf_ca, srp_sf_els, srp_sf_ct,"
"0","         ami_es, ami_sm, ami_ba) "
"0",""
"0","# Scale the columns separately"
"0","subscale_data_scaled <- subscale_data %>%"
"0","  ungroup() %>%"
"0","  mutate(across(-participant.id_in_session, ~as.vector(scale(.x))))"
"0",""
"0","# Define function for moderation analysis"
"0","run_moderation_analysis <- function(data, scale_name, subscales = NULL) {"
"0","  # Run moderation for main scale"
"0","  main_model <- lmer(mean_bet_diff ~ consensus_group * scale_name + "
"0","                    age + (1|participant.id_in_session),"
"0","                    data = data,"
"0","                    control = lmerControl(optimizer = ""bobyqa""))"
"0","  "
"0","  results <- list(main = list("
"0","    scale = scale_name,"
"0","    model = main_model,"
"0","    summary = summary(main_model)"
"0","  ))"
"0","  "
"0","  # Run for subscales if they exist"
"0","  if (!is.null(subscales)) {"
"0","    subscale_results <- map(subscales, function(subscale) {"
"0","      if(subscale %in% names(data)) {  # Only run if subscale exists in data"
"0","        sub_model <- lmer(as.formula(paste("
"0","          ""mean_bet_diff ~ consensus_group *"", subscale,"
"0","          ""+ age + (1|participant.id_in_session)"""
"0","        )),"
"0","        data = data,"
"0","        control = lmerControl(optimizer = ""bobyqa""))"
"0","        "
"0","        list("
"0","          scale = subscale,"
"0","          model = sub_model,"
"0","          summary = summary(sub_model)"
"0","        )"
"0","      } else {"
"0","        NULL"
"0","      }"
"0","    })"
"0","    results$subscales <- compact(subscale_results)  # Remove NULL results"
"0","  }"
"0","  "
"0","  return(results)"
"0","}"
"0",""
"0","# Join scaled subscales to processed_data"
"0","processed_data_with_subscales <- processed_data %>%"
"0","  left_join(subscale_data_scaled, by = ""participant.id_in_session"")"
"0",""
"0","# Run the moderation analysis for significant results"
"0","if(length(significant_vars) > 0) {"
"0","  moderation_results <- map(significant_vars, function(scale) {"
"0","    subscales <- subscale_mapping[[scale]]"
"0","    "
"0","    # Prepare data with scale and subscales"
"0","    mod_data <- processed_data_with_subscales %>%"
"0","      rename(scale_name = !!scale)"
"0","    "
"0","    run_moderation_analysis(mod_data, ""scale_name"", subscales)"
"0","  })"
"0","  "
"0","  # Print results and create visualization"
"0","  for(i in seq_along(moderation_results)) {"
"0","    scale_name <- significant_vars[i]"
"0","    results <- moderation_results[[i]]"
"0","    "
"0","    cat(""\nModeration Analysis Results for"", scale_name, ""\n"")"
"0","    cat(""Main Scale Results:\n"")"
"0","    print(anova(results$main$model))"
"0","    "
"0","    if(!is.null(results$subscales)) {"
"0","      cat(""\nSubscale Results:\n"")"
"0","      for(sub_result in results$subscales) {"
"0","        cat(""\nSubscale:"", sub_result$scale, ""\n"")"
"0","        print(anova(sub_result$model))"
"0","      }"
"0","    }"
"0","    "
"0","    # Create visualization for significant moderations"
"0","    plot_moderation <- function(model, title) {"
"0","      # Create data frame for predictions"
"0","      new_data <- expand.grid("
"0","        consensus_group = unique(model@frame$consensus_group),"
"0","        scale_name = c(-1, 0, 1),"
"0","        age = 0  # mean of scaled age"
"0","      )"
"0","      "
"0","      # Get predictions"
"0","      new_data$predicted <- predict(model, newdata = new_data, re.form = NA)"
"0","      "
"0","      # Create plot"
"0","      ggplot(new_data, "
"0","             aes(x = consensus_group, "
"0","                 y = predicted, "
"0","                 color = as.factor(scale_name),"
"0","                 group = scale_name)) +"
"0","        geom_line() +"
"0","        geom_point() +"
"0","        scale_color_manual(values = c(""red"", ""purple"", ""blue""),"
"0","                          name = ""Scale Score"","
"0","                          labels = c(""-1 SD"", ""Mean"", ""+1 SD"")) +"
"0","        theme_custom +"
"0","        labs(title = title,"
"0","             x = ""Consensus Group"","
"0","             y = ""Predicted Bet Difference"")"
"0","    }"
"0","    "
"0","    print(plot_moderation(results$main$model, "
"0","                         paste(""Moderation Effect of"", scale_name)))"
"0","  }"
"0","} else {"
"0","  print(""No significant results to analyze with moderation"")"
"0","}"
"2","boundary (singular) fit: see help('isSingular')
"
"2","boundary (singular) fit: see help('isSingular')
"
"2","boundary (singular) fit: see help('isSingular')
"
"2","boundary (singular) fit: see help('isSingular')
"
"1","
Moderation Analysis Results for"
"1"," "
"1","dass"
"1"," "
"1","
"
"1","Main Scale Results:
"
"1","Type III Analysis of Variance Table with Satterthwaite's method"
"1","
"
"1","                          "
"1","  Sum Sq"
"1"," Mean Sq"
"1"," NumDF"
"1"," DenDF"
"1"," F value"
"1","  Pr(>F)"
"1","  "
"1","
consensus_group           "
"1"," 1.02180"
"1"," 0.25545"
"1","     4"
"1","    38"
"1","  1.8663"
"1"," 0.13642"
"1","  "
"1","
scale_name                "
"1"," 0.21826"
"1"," 0.21826"
"1","     1"
"1","    38"
"1","  1.5946"
"1"," 0.21436"
"1","  "
"1","
age                       "
"1"," 0.06954"
"1"," 0.06954"
"1","     1"
"1","    38"
"1","  0.5081"
"1"," 0.48032"
"1","  "
"1","
consensus_group:scale_name"
"1"," 1.31725"
"1"," 0.32931"
"1","     4"
"1","    38"
"1","  2.4059"
"1"," 0.06638"
"1"," ."
"1","
"
"1","---
Signif. codes:  "
"1",""
"1","0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1"
"1","
"
"1","
Subscale Results:
"
"1","
Subscale:"
"1"," "
"1","dass_a"
"1"," "
"1","
"
"1","Type III Analysis of Variance Table with Satterthwaite's method"
"1","
"
"1","                      "
"1","  Sum Sq"
"1"," Mean Sq"
"1"," NumDF"
"1"," DenDF"
"1"," F value"
"1","  Pr(>F)"
"1","  "
"1","
consensus_group       "
"1"," 0.63615"
"1"," 0.15904"
"1","     4"
"1","    38"
"1","  1.2168"
"1"," 0.31976"
"1","  "
"1","
dass_a                "
"1"," 0.01787"
"1"," 0.01787"
"1","     1"
"1","    38"
"1","  0.1367"
"1"," 0.71364"
"1","  "
"1","
age                   "
"1"," 0.00647"
"1"," 0.00647"
"1","     1"
"1","    38"
"1","  0.0495"
"1"," 0.82506"
"1","  "
"1","
consensus_group:dass_a"
"1"," 1.66822"
"1"," 0.41705"
"1","     4"
"1","    38"
"1","  3.1909"
"1"," 0.02356"
"1"," *"
"1","
"
"1","---
Signif. codes:  "
"1",""
"1","0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1"
"1","
"
"1","
Subscale:"
"1"," "
"1","dass_d"
"1"," "
"1","
"
"1","Type III Analysis of Variance Table with Satterthwaite's method"
"1","
"
"1","                      "
"1","  Sum Sq"
"1","  Mean Sq"
"1"," NumDF"
"1"," DenDF"
"1"," F value"
"1"," Pr(>F)"
"1","
consensus_group       "
"1"," 0.79679"
"1"," 0.199197"
"1","     4"
"1","    38"
"1","  1.2365"
"1"," 0.3118"
"1","
dass_d                "
"1"," 0.24979"
"1"," 0.249792"
"1","     1"
"1","    38"
"1","  1.5506"
"1"," 0.2207"
"1","
age                   "
"1"," 0.00019"
"1"," 0.000188"
"1","     1"
"1","    38"
"1","  0.0012"
"1"," 0.9729"
"1","
consensus_group:dass_d"
"1"," 0.26545"
"1"," 0.066362"
"1","     4"
"1","    38"
"1","  0.4119"
"1"," 0.7989"
"1","
"
"1","
Subscale:"
"1"," "
"1","dass_s"
"1"," "
"1","
"
"1","Type III Analysis of Variance Table with Satterthwaite's method"
"1","
"
"1","                      "
"1","  Sum Sq"
"1","  Mean Sq"
"1"," NumDF"
"1"," DenDF"
"1"," F value"
"1"," Pr(>F)"
"1","
consensus_group       "
"1"," 0.83070"
"1"," 0.207675"
"1","     4"
"1","    38"
"1","  1.3347"
"1"," 0.2748"
"1","
dass_s                "
"1"," 0.00832"
"1"," 0.008325"
"1","     1"
"1","    38"
"1","  0.0535"
"1"," 0.8183"
"1","
age                   "
"1"," 0.02469"
"1"," 0.024694"
"1","     1"
"1","    38"
"1","  0.1587"
"1"," 0.6926"
"1","
consensus_group:dass_s"
"1"," 0.71669"
"1"," 0.179173"
"1","     4"
"1","    38"
"1","  1.1515"
"1"," 0.3474"
"1","
"
