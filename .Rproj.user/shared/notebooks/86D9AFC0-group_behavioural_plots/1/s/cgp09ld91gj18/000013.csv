"0","source(here(""R"", ""mixed_models_group.R""))"
"2","[38;5;255m[90m[conflicted][38;5;255m Removing existing preference.[39m"
"2","[38;5;255m[90m[conflicted][38;5;255m Will prefer [1m[34mdplyr[38;5;255m[22m::select over any other package.[39m"
"2","[38;5;255m[90m[conflicted][38;5;255m Removing existing preference.[39m"
"2","[38;5;255m[90m[conflicted][38;5;255m Will prefer [1m[34mdplyr[38;5;255m[22m::filter over any other package.[39m"
"2","[38;5;255m[90m[conflicted][38;5;255m Removing existing preference.[39m"
"2","[38;5;255m[90m[conflicted][38;5;255m Will prefer [1m[34mlmerTest[38;5;255m[22m::lmer over any other package.[39m"
"0","################## SPECIFIC PREPROCESSING ###################"
"0","process_consensus_data <- function(data, outcome_type) {"
"0","  processed <- if(outcome_type == ""switch"") {"
"0","    data %>%"
"0","      group_by(participant.id_in_session, "
"0","               consensus = player.choice1_with, "
"0","               gender) %>%"
"0","      summarise("
"0","        outcome_value = mean(player.switch_vs_stay) * 100,"
"0","        .groups = 'drop'"
"0","      )"
"0","  } else {"
"0","    data %>%"
"0","      mutate(bet_difference = player.bet2 - player.bet1) %>%"
"0","      group_by(participant.id_in_session,"
"0","               consensus = player.choice1_with,"
"0","               gender) %>%"
"0","      summarise("
"0","        outcome_value = mean(bet_difference),"
"0","        .groups = 'drop'"
"0","      )"
"0","  }"
"0","  "
"0","  processed %>%"
"0","    left_join("
"0","      data %>%"
"0","        group_by(participant.id_in_session) %>%"
"0","        slice(1) %>%"
"0","        select(participant.id_in_session, age),"
"0","      by = ""participant.id_in_session"""
"0","    ) %>%"
"0","    mutate("
"0","      direction = if_else(consensus >= 0.5, ""With group"", ""Against group""),"
"0","      consensus_numeric = case_when("
"0","        consensus %in% c(0, 1) ~ 2,"
"0","        consensus %in% c(0.25, 0.75) ~ 1,"
"0","        consensus == 0.5 ~ 0"
"0","      ),"
"0","      gender = factor(gender),"
"0","      age = scale(age)[,1]"
"0","    )"
"0","}"
"0",""
"0","################## SPECIFIC MODEL FORMULAS ###################"
"0","consensus_model_formulas <- list("
"0","  m1 = outcome_value ~ direction * consensus_numeric + age + "
"0","         (1|participant.id_in_session),"
"0","  "
"0","  m2 = outcome_value ~ direction * consensus_numeric + age + "
"0","         (1|participant.id_in_session) + (1|gender),"
"0","  "
"0","  m3 = outcome_value ~ direction * consensus_numeric + age + "
"0","         (1|participant.id_in_session) + (1|gender) + "
"0","         (1|direction:participant.id_in_session),"
"0","  "
"0","  m4 = outcome_value ~ direction * consensus_numeric + age + "
"0","         (1|participant.id_in_session) + (1|gender) + "
"0","         (1|consensus_numeric:participant.id_in_session),"
"0","  "
"0","  m5 = outcome_value ~ direction * consensus_numeric + age + "
"0","         (1|participant.id_in_session) + (1|gender) + "
"0","         (1|direction:participant.id_in_session) + "
"0","         (1|consensus_numeric:participant.id_in_session)"
"0",")"
"0",""
"0","################## SPECIFIC PLOTTING FUNCTION ###################"
"0","create_consensus_plot <- function(data, model_results, anova_results, params) {"
"0","  interaction_p <- anova_results[""direction:consensus_numeric"", ""Pr(>Chisq)""]"
"0","  "
"0","  plot_data <- data %>%"
"0","    mutate("
"0","      consensus_level = case_when("
"0","        consensus_numeric == 0 ~ ""2:2"","
"0","        consensus_numeric == 1 ~ ""3:1"","
"0","        consensus_numeric == 2 ~ ""4:0"""
"0","      ),"
"0","      consensus_level = factor(consensus_level, levels = c(""2:2"", ""3:1"", ""4:0""))"
"0","    ) %>%"
"0","    group_by(consensus_level, direction) %>%"
"0","    summarise("
"0","      mean_outcome = mean(outcome_value),"
"0","      se = sd(outcome_value) / sqrt(n()),"
"0","      .groups = 'drop'"
"0","    )"
"0",""
"0","  ggplot(plot_data, "
"0","         aes(x = consensus_level, "
"0","             y = mean_outcome, "
"0","             color = direction,"
"0","             group = direction)) +"
"0","    geom_line(linewidth = 1) +"
"0","    geom_point(size = 3) +"
"0","    geom_errorbar(aes(ymin = mean_outcome - se, "
"0","                      ymax = mean_outcome + se), "
"0","                  width = 0.2,"
"0","                  linewidth = 1) +"
"0","    geom_ribbon(aes(ymin = mean_outcome - se, "
"0","                    ymax = mean_outcome + se,"
"0","                    fill = direction), "
"0","                alpha = 0.2,"
"0","                color = NA) +"
"0","    scale_color_manual(values = c(""Against group"" = ""red"", ""With group"" = ""blue""),"
"0","                      name = NULL) +"
"0","    scale_fill_manual(values = c(""Against group"" = ""red"", ""With group"" = ""blue""),"
"0","                      name = NULL) +"
"0","    labs(x = ""Group consensus"","
"0","         y = params$y_label) +"
"0","    theme_custom +"
"0","    theme(legend.position = ""right"") +"
"0","    annotate(""text"","
"0","             x = 1.5,"
"0","             y = max(plot_data$mean_outcome + plot_data$se) + params$y_offset,"
"0","             label = sprintf(""Interaction: p = %.3f"", interaction_p),"
"0","             size = 3)"
"0","}"
"0",""
"0","################## RUN ANALYSES ###################"
"0","# Read data"
"0","data <- read_csv(here(""data"", ""preprocessed"", ""merged_test_data.csv""), "
"0","                 show_col_types = FALSE)"
"0",""
"0","# Run switch analysis"
"0","switch_results <- run_mixed_model_pipeline("
"0","  data = data,"
"0","  preprocessing_function = function(x) process_consensus_data(x, ""switch""),"
"0","  model_formulas = consensus_model_formulas,"
"0","  plot_function = create_consensus_plot,"
"0","  analysis_name = ""Choice Switch by Group Consensus"","
"0","  output_path = here(""output"", ""behav"", ""group"", "
"0","                    ""choice_switching_by_group_consensus.txt""),"
"0","  additional_params = list("
"0","    emmeans_specs = c(""direction"", ""consensus_numeric""),"
"0","    y_label = ""Choice switch probability (%)"","
"0","    y_offset = 5"
"0","  )"
"0",")"
"2","boundary (singular) fit: see help('isSingular')
"
"2","boundary (singular) fit: see help('isSingular')
"
"2","boundary (singular) fit: see help('isSingular')
"
"2","boundary (singular) fit: see help('isSingular')
"
"2","boundary (singular) fit: see help('isSingular')
"
