"0","source(here(""R"", ""mixed_models_group.R""))"
"2","[38;5;255m[90m[conflicted][38;5;255m Removing existing preference.[39m"
"2","[38;5;255m[90m[conflicted][38;5;255m Will prefer [1m[34mdplyr[38;5;255m[22m::select over any other package.[39m"
"2","[38;5;255m[90m[conflicted][38;5;255m Removing existing preference.[39m"
"2","[38;5;255m[90m[conflicted][38;5;255m Will prefer [1m[34mdplyr[38;5;255m[22m::filter over any other package.[39m"
"2","[38;5;255m[90m[conflicted][38;5;255m Removing existing preference.[39m"
"2","[38;5;255m[90m[conflicted][38;5;255m Will prefer [1m[34mlmerTest[38;5;255m[22m::lmer over any other package.[39m"
"0","################## SPECIFIC PREPROCESSING ###################"
"0","process_switch_accuracy_data <- function(data, outcome_type) {"
"0","  # Create separate dataframes for With and Against groups"
"0","  df_with <- data %>%"
"0","    mutate(direction = ""With group"") %>%"
"0","    filter(player.choice1_with > 0.5)"
"0","  "
"0","  df_against <- data %>%"
"0","    mutate(direction = ""Against group"") %>%"
"0","    filter(player.choice1_with <= 0.5)"
"0","  "
"0","  # Combine and prepare data"
"0","  bind_rows(df_with, df_against) %>%"
"0","    filter(!is.na(choice_switch_across_trials)) %>%"
"0","    mutate("
"0","      consensus_numeric = case_when("
"0","        player.choice1_with %in% c(0, 1) ~ 2,"
"0","        player.choice1_with %in% c(0.25, 0.75) ~ 1,"
"0","        player.choice1_with == 0.5 ~ 0"
"0","      ),"
"0","      direction = factor(direction),"
"0","      gender = factor(gender),"
"0","      choice_switch_across_trials = factor(choice_switch_across_trials),"
"0","      participant.id_in_session = factor(participant.id_in_session)"
"0","    )"
"0","}"
"0",""
"0","################## SPECIFIC MODEL FORMULAS ###################"
"0","get_switch_accuracy_formulas <- function(outcome_var) {"
"0","  formula_base <- as.formula(paste("
"0","    outcome_var,"
"0","    ""~ direction * consensus_numeric * choice_switch_across_trials"""
"0","  ))"
"0","  "
"0","  list("
"0","    m1 = update(formula_base, . ~ . + (1|participant.id_in_session)),"
"0","    "
"0","    m2 = update(formula_base, "
"0","                . ~ . + (1|participant.id_in_session) + (1|gender)),"
"0","    "
"0","    m3 = update(formula_base,"
"0","                . ~ . + (1|participant.id_in_session) + (1|gender) + "
"0","                (1|direction:participant.id_in_session)),"
"0","    "
"0","    m4 = update(formula_base,"
"0","                . ~ . + (1|participant.id_in_session) + (1|gender) + "
"0","                (1|consensus_numeric:participant.id_in_session)),"
"0","    "
"0","    m5 = update(formula_base,"
"0","                . ~ . + (1|participant.id_in_session) + (1|gender) + "
"0","                (1|direction:participant.id_in_session) + "
"0","                (1|consensus_numeric:participant.id_in_session))"
"0","  )"
"0","}"
"0",""
"0","################## SPECIFIC PLOTTING FUNCTION ###################"
"0","create_switch_accuracy_plot <- function(data, model_results, anova_results, params) {"
"0","  interaction_p <- as.numeric(anova_results["
"0","    ""direction:consensus_numeric:choice_switch_across_trials"", "
"0","    ""Pr(>Chisq)""])"
"0","  "
"0","  plot_data <- data %>%"
"0","    group_by(consensus_numeric, direction, choice_switch_across_trials) %>%"
"0","    summarise("
"0","      value = mean(!!sym(params$outcome_var)),"
"0","      se = sd(!!sym(params$outcome_var)) / sqrt(n()),"
"0","      .groups = 'drop'"
"0","    ) %>%"
"0","    mutate("
"0","      consensus_category = case_when("
"0","        consensus_numeric == 2 ~ ""4:0"","
"0","        consensus_numeric == 1 ~ ""3:1"","
"0","        consensus_numeric == 0 ~ ""2:2"""
"0","      ),"
"0","      consensus_category = factor(consensus_category, "
"0","                                levels = c(""2:2"", ""3:1"", ""4:0""))"
"0","    )"
"0","  "
"0","  if(params$is_accuracy) {"
"0","    plot_data <- plot_data %>%"
"0","      mutate("
"0","        value = value * 100,"
"0","        se = se * 100"
"0","      )"
"0","  }"
"0","  "
"0","  ggplot(plot_data, "
"0","         aes(x = consensus_category, "
"0","             y = value, "
"0","             color = direction, "
"0","             group = direction)) +"
"0","    facet_wrap(~ifelse(choice_switch_across_trials == 1, "
"0","                      ""Switch trials"", ""Stay trials"")) +"
"0","    geom_line(linewidth = 1) +"
"0","    geom_point(size = 3) +"
"0","    geom_errorbar(aes(ymin = value - se,"
"0","                      ymax = value + se),"
"0","                  width = 0.2) +"
"0","    geom_ribbon(aes(ymin = value - se,"
"0","                    ymax = value + se,"
"0","                    fill = direction),"
"0","                alpha = 0.2,"
"0","                color = NA) +"
"0","    scale_color_manual(values = c(""Against group"" = ""red"", "
"0","                                 ""With group"" = ""blue"")) +"
"0","    scale_fill_manual(values = c(""Against group"" = ""red"", "
"0","                                ""With group"" = ""blue"")) +"
"0","    labs("
"0","      x = ""Group consensus"","
"0","      y = params$y_label,"
"0","      color = ""Direction"","
"0","      fill = ""Direction"","
"0","      title = ""Three-way interaction:"","
"0","      subtitle = sprintf(""P < %.1e"", interaction_p)"
"0","    ) +"
"0","    theme_custom +"
"0","    {if(params$is_accuracy) "
"0","      scale_y_continuous(limits = c(10, 70), breaks = seq(10, 70, by = 10))}"
"0","}"
"0",""
"0","################## RUN ANALYSES ###################"
"0","# Read data"
"0","data <- read_csv(here(""data"", ""preprocessed"", ""merged_test_data.csv""), "
"0","                 show_col_types = FALSE)"
"0",""
"0","# Run accuracy analysis"
"0","accuracy_results <- run_mixed_model_pipeline("
"0","  data = data,"
"0","  preprocessing_function = function(x) process_switch_accuracy_data(x, ""accuracy""),"
"0","  model_formulas = get_switch_accuracy_formulas(""player.choice1_accuracy""),"
"0","  plot_function = create_switch_accuracy_plot,"
"0","  analysis_name = ""Choice Accuracy by Switch and Consensus"","
"0","  output_path = here(""output"", ""behav"", ""group"", "
"0","                    ""choice_accuracy_by_switch_and_consensus.txt""),"
"0","  additional_params = list("
"0","    outcome_var = ""player.choice1_accuracy"","
"0","    y_label = ""Choice 1 accuracy on t + 1 (%)"","
"0","    is_accuracy = TRUE,"
"0","    emmeans_specs = c(""direction"", ""consensus_numeric"", ""choice_switch_across_trials"")"
"0","  )"
"0",")"
"2","boundary (singular) fit: see help('isSingular')
"
"2","boundary (singular) fit: see help('isSingular')
"
"2","boundary (singular) fit: see help('isSingular')
"
"2","boundary (singular) fit: see help('isSingular')
"
"2","boundary (singular) fit: see help('isSingular')
"
"2","Warning: numerical expression has 5900 elements: only the first used"
